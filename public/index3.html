<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
	现在我想构建一个页面，采用index3的配色，并且保留index3的header这一部分,并且有一个框用于显示用户的花园照片，然后下面是评论区
-->
<html>
	<head>
		<title>Garden Craft by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="is-preload">

		<!-- Header -->
			<section id="header">
				<header>
					<span class="image avatar"><img src="images/avatar.jpg" alt="" /></span>
					<h1 id="logo"><a href="#">Willis Corto</a></h1>
					<p>I got reprogrammed by a rogue AI<br />
					and now I'm totally cray</p>
				</header>
				<nav id="nav">
					<ul>
						<li><a href="#one" class="active">About</a></li>
						<li><a href="#two">Things I Can Do</a></li>

						<li><a href="#three">Collaborative garden design</a></li>
						<li><a href="#four">Generate your garden</a></li>
					</ul>
				</nav>
				<footer>
					<ul class="icons">
						<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon brands fa-github"><span class="label">Github</span></a></li>
						<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
					</ul>
				</footer>
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">

						<!-- One -->
							<section id="one">
								<div class="image main" data-position="center">
									<img src="images/banner.jpg" alt="" />
								</div>
								<div class="container">
									<header class="major">
										<h2>Garden Craft</h2>
										<p>You can upload photos and generate models<br />
										 by <a href="#four">press here</a>.</p>
									</header>
									<p>GardenCraft is an innovative garden management and design software designed to help garden enthusiasts easily manage and beautify their outdoor spaces. Users can upload photos of their gardens, automatically generate 3D garden models, and invite other designers to participate in redesigning, gaining unique inspiration and advice.</p>
								</div>
							</section>

						<!-- Two -->
							<section id="two">
								<div class="container">
									<h3>Things I Can Do</h3>
									<p>Integer eu ante ornare amet commetus vestibulum blandit integer in curae ac faucibus integer non. Adipiscing cubilia elementum integer lorem ipsum dolor sit amet.</p>
									<ul class="feature-icons">
										<li class="icon solid fa-code">Write all the code</li>
										<li class="icon solid fa-cubes">Stack small boxes</li>
										<li class="icon solid fa-book">Read books and stuff</li>
										<li class="icon solid fa-coffee">Drink much coffee</li>
										<li class="icon solid fa-bolt">Lightning bolt</li>
										<li class="icon solid fa-users">Shadow clone technique</li>
									</ul>
								</div>
							</section>

						<!-- Three -->
							<section id="three">
								<div class="container">
									<h3>Collaborative garden design</h3>
									<p>Here, you can invite other users to help design your garden model (please click here to view your garden model). Alternatively, you can share your creativity by designing or providing suggestions for the garden models uploaded by others in the list below. Through collaboration and exchange, discover more inspiration and create a truly unique garden design!</p>
									<div class="features" id="uploaded-gardens">
										<!-- 原有的内容保留 -->
										<article>
										  <a href="garden_page.html" class="image"><img src="images/pic01.jpg" alt="" /></a>
										  <div class="inner">
											<h4>Possibly broke spacetime</h4>
											<p>Integer eu ante ornare amet commetus vestibulum blandit integer in curae ac faucibus integer adipiscing ornare amet.</p>
										  </div>
										</article>
										<!-- 这里是动态插入内容的容器 -->
									  </div>
								</div>
							</section>

						<!-- Four -->
							<section id="four">
								<div class="container">
									<h3>Upload you garden photo</h3>
									<p>Generating the garden model will take some time, please wait.</p>
									<form method="post" action="#">
										<div class="row gtr-uniform">
											<div class="col-6 col-12-xsmall"><input type="text" name="name" id="name" placeholder="Name" /></div>
											<div class="col-6 col-12-xsmall"><input type="email" name="email" id="email" placeholder="Email" /></div>
											<div class="col-12"><input type="text" name="subject" id="subject" placeholder="Subject" /></div>
											<form method="post" action="#" enctype="multipart/form-data">
												<div class="col-12">
													<div class="drop-area" id="drop-area">
														<i class="fas fa-cloud-upload-alt"></i> <!-- 使用 FontAwesome 图标 -->
														<p>Drag and drop files here or click to select files</p>
														<input type="file" name="garden_photo" id="fileInput" accept="image/*" style="display: none;" />
														<img id="preview" style="max-width: 100%; display: none;" />
													</div>
												</div>
												<div class="col-12">
													<ul class="actions">
														<li><input type="submit" class="primary" id="uploadButton" value="Upload Photo" /></li>
														<li><input type="reset" value="Reset Form" /></li>
													</ul>
												</div>
												
											</form>
											
										</div>
									</form>
								</div>
							</section>
							<div id="loading" style="display: none;">
								<i class="fas fa-spinner fa-spin"></i>
								<p>Generating a 3D garden model.</p>
							</div>
						

					</div>

				<!-- Footer -->
					<section id="footer">
						<div class="container">
							<ul class="copyright">
								<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</section>

			</div>

<!-- Scripts -->
<script>
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('preview'); // 预览图片的元素
    const uploadButton = document.getElementById('uploadButton');
    const loadingIcon = document.getElementById('loading');
    const uploadText = document.getElementById('upload-text'); // 提示文字的元素
    const container = document.querySelector('#four'); // 选择你的页面内容容器

    // 点击区域时触发文件选择
    dropArea.addEventListener('click', () => {
        fileInput.click();
    });

    // 当文件拖进来时高亮显示区域
    dropArea.addEventListener('dragover', (event) => {
        event.preventDefault();
        dropArea.classList.add('hover');
    });

    // 当文件离开拖放区域时移除高亮
    dropArea.addEventListener('dragleave', () => {
        dropArea.classList.remove('hover');
    });

    // 处理文件放入事件，显示预览图片
    dropArea.addEventListener('drop', (event) => {
        event.preventDefault();
        dropArea.classList.remove('hover');
        const file = event.dataTransfer.files[0]; // 获取第一个文件
        fileInput.files = event.dataTransfer.files; // 将文件分配给 input

        // 显示预览图片
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block'; // 显示图片预览
                uploadText.style.display = 'none'; // 隐藏提示文字
            }
            reader.readAsDataURL(file); // 读取文件
        }
    });

    // 监听文件选择事件，显示预览图片
    fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                uploadText.style.display = 'none';
            }
            reader.readAsDataURL(file);
        }
    });

    // 上传功能扩展：存储图片和信息
    uploadButton.addEventListener('click', (event) => {
        event.preventDefault(); // 阻止默认表单提交

        const file = fileInput.files[0];
        const subject = document.getElementById('subject').value;
        const username = localStorage.getItem('username');

        if (!file || !subject || !username) {
            alert('请填写所有信息并选择图片');
            return;
        }

        const formData = new FormData();
        formData.append('image', file);
        formData.append('subject', subject);
        formData.append('username', username);

        // 显示加载图标
        loadingIcon.style.display = 'block';
        container.classList.add('blur');

        // 模拟上传延迟（10秒）
        setTimeout(() => {
            // 发送上传请求
            fetch('/upload', {
                method: 'POST',
                body: formData
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      // 上传成功后显示图片并生成新的用户 garden_page.html
                      const newArticle = document.createElement('article');
                      newArticle.innerHTML = `
                        <a href="garden_page.html?userId=${data.userId}" class="image"><img src="${data.imagePath}" alt="Garden Image" /></a>
                        <div class="inner">
                          <h4>${data.subject}</h4>
                          <p>${username}</p>
                        </div>
                      `;
                      document.querySelector('.features').appendChild(newArticle);

                      // 隐藏加载图标
                      loadingIcon.style.display = 'none';
                      container.classList.remove('blur');
                  } else {
                      alert('上传失败');
                  }
              })
              .catch(error => {
                  console.error('上传错误:', error);
                  loadingIcon.style.display = 'none';
                  container.classList.remove('blur');
              });
        }, 10000); // 10秒等待
    });

	// 上传成功后显示图片并生成新的用户 garden_page.html
if (data.success) {
    window.location.href = `garden_page.html?userId=${data.userId}`;
} else {
    alert('上传失败');
}

// 上传成功后显示图片并生成新的用户 garden_page.html
if (data.success) {
    const newArticle = document.createElement('article');
    newArticle.innerHTML = `
      <a href="garden_page.html?userId=${data.userId}" class="image"><img src="${data.imagePath}" alt="Garden Image" /></a>
      <div class="inner">
        <h4>${data.subject}</h4>
        <p>${username}</p>
      </div>
    `;
    document.getElementById('uploaded-gardens').appendChild(newArticle);
}


	document.addEventListener('DOMContentLoaded', function() {
        const username = localStorage.getItem('username');
        if (username) {
            // 更新 h1 标签中的用户名
            document.getElementById('logo').innerHTML = `<a href="#">${username}</a>`;
        } else {
            window.location.href = "/login.html";  // 如果没有用户名，跳转到登录页面
        }
    });
</script>



	</body>
</html>